version: '3.8'

x-app-env: &app-env
  - WEB_URL=https://plane.devcode.live
  - DEBUG=0
  - DJANGO_SETTINGS_MODULE=plane.settings.production
  - DATABASE_URL=postgresql://username:password@your-postgres-host:5432/plane_db
  - REDIS_URL=redis://your-redis-host:6379/0
  - SECRET_KEY=your-secret-key-change-this
  - USE_MINIO=0
  - AWS_REGION=us-east-1
  - AWS_ACCESS_KEY_ID=your-s3-access-key
  - AWS_SECRET_ACCESS_KEY=your-s3-secret-key
  - AWS_S3_BUCKET_NAME=your-plane-bucket

services:
  plane-web:
    image: makeplane/plane-frontend:latest
    restart: unless-stopped
    command: /usr/local/bin/start.sh web/server.js web
    expose:
      - "3000"
    environment: *app-env
    depends_on:
      - plane-api
    networks:
      - plane

  plane-api:
    image: makeplane/plane-backend:latest
    restart: unless-stopped
    command: ./bin/takeoff
    expose:
      - "8000"
    environment: *app-env
    networks:
      - plane

  plane-worker:
    image: makeplane/plane-backend:latest
    restart: unless-stopped
    command: ./bin/worker
    environment: *app-env
    depends_on:
      - plane-api
    networks:
      - plane

  plane-beat-worker:
    image: makeplane/plane-backend:latest
    restart: unless-stopped
    command: ./bin/beat
    environment: *app-env
    networks:
      - plane

networks:
  plane:
    driver: bridge
